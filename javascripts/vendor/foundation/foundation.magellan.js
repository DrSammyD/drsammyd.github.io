!function(t,e){"use strict";Foundation.libs["magellan-expedition"]={name:"magellan-expedition",version:"5.5.0",settings:{active_class:"active",threshold:0,destination_threshold:20,throttle_delay:30,fixed_top:0,offset_by_height:!0,duration:700,easing:"swing"},init:function(t,e,i){Foundation.inherit(this,"throttle"),this.bindings(e,i)},events:function(){var i=this,n=i.S,r=i.settings;i.set_expedition_position(),n(i.scope).off(".magellan").on("click.fndtn.magellan","["+i.add_namespace("data-magellan-arrival")+'] a[href^="#"]',function(e){e.preventDefault();var n=t(this).closest("["+i.attr_name()+"]"),r=n.data("magellan-expedition-init"),a=this.hash.split("#").join(""),s=t('a[name="'+a+'"]');0===s.length&&(s=t("#"+a));var o=s.offset().top-r.destination_threshold+1;r.offset_by_height&&(o-=n.outerHeight()),t("html, body").stop().animate({scrollTop:o},r.duration,r.easing,function(){history.pushState?history.pushState(null,null,"#"+a):location.hash="#"+a})}).on("scroll.fndtn.magellan",i.throttle(this.check_for_arrivals.bind(this),r.throttle_delay)),t(e).on("resize.fndtn.magellan",i.throttle(this.set_expedition_position.bind(this),r.throttle_delay))},check_for_arrivals:function(){var t=this;t.update_arrivals(),t.update_expedition_positions()},set_expedition_position:function(){var e=this;t("["+this.attr_name()+"=fixed]",e.scope).each(function(){var i,n,r=t(this),a=r.data("magellan-expedition-init"),s=r.attr("styles");r.attr("style",""),i=r.offset().top+a.threshold,n=parseInt(r.data("magellan-fixed-top")),isNaN(n)||(e.settings.fixed_top=n),r.data(e.data_attr("magellan-top-offset"),i),r.attr("style",s)})},update_expedition_positions:function(){var i=this,n=t(e).scrollTop();t("["+this.attr_name()+"=fixed]",i.scope).each(function(){var e=t(this),r=e.data("magellan-expedition-init"),a=e.attr("style"),s=e.data("magellan-top-offset");if(n+i.settings.fixed_top>=s){var o=e.prev("["+i.add_namespace("data-magellan-expedition-clone")+"]");0===o.length&&(o=e.clone(),o.removeAttr(i.attr_name()),o.attr(i.add_namespace("data-magellan-expedition-clone"),""),e.before(o)),e.css({position:"fixed",top:r.fixed_top}).addClass("fixed")}else e.prev("["+i.add_namespace("data-magellan-expedition-clone")+"]").remove(),e.attr("style",a).css("position","").css("top","").removeClass("fixed")})},update_arrivals:function(){var i=this,n=t(e).scrollTop();t("["+this.attr_name()+"]",i.scope).each(function(){var e=t(this),r=e.data(i.attr_name(!0)+"-init"),a=i.offsets(e,n),s=e.find("["+i.add_namespace("data-magellan-arrival")+"]"),o=!1;a.each(function(t,n){if(n.viewport_offset>=n.top_offset){var a=e.find("["+i.add_namespace("data-magellan-arrival")+"]");return a.not(n.arrival).removeClass(r.active_class),n.arrival.addClass(r.active_class),o=!0,!0}}),o||s.removeClass(r.active_class)})},offsets:function(e,i){var n=this,r=e.data(n.attr_name(!0)+"-init"),a=i;return e.find("["+n.add_namespace("data-magellan-arrival")+"]").map(function(){var i=t(this).data(n.data_attr("magellan-arrival")),s=t("["+n.add_namespace("data-magellan-destination")+"="+i+"]");if(s.length>0){var o=s.offset().top-r.destination_threshold;return r.offset_by_height&&(o-=e.outerHeight()),o=Math.floor(o),{destination:s,arrival:t(this),top_offset:o,viewport_offset:a}}}).sort(function(t,e){return t.top_offset<e.top_offset?-1:t.top_offset>e.top_offset?1:0})},data_attr:function(t){return this.namespace.length>0?this.namespace+"-"+t:t},off:function(){this.S(this.scope).off(".magellan"),this.S(e).off(".magellan")},reflow:function(){var e=this;t("["+e.add_namespace("data-magellan-expedition-clone")+"]",e.scope).remove()}}}(jQuery,window,window.document);