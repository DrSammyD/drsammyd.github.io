define(["durandal/system","durandal/composition","jquery"],function(e,t,n){function r(e,t){e.classList.remove(t?"entrance-in-fade":"entrance-in"),e.classList.remove("entrance-out")}var i=100,a={left:"0px",opacity:1},o={left:"",top:"",right:"",bottom:"",position:"",opacity:""},s=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/MSIE/),u=!1,l="Webkit Moz O ms Khtml".split(" "),c=document.createElement("div");if(void 0!==c.style.animationName&&(u=!0),!u)for(var d=0;d<l.length;d++)if(void 0!==c.style[l[d]+"AnimationName"]){u=!0;break}e.log(u?s?"Using CSS3/jQuery mixed animations.":"Using CSS3 animations.":"Using jQuery animations.");var f=function(t){return e.defer(function(e){function l(){e.resolve()}function c(){t.keepScrollPosition||n(document).scrollTop(0)}function d(){c(),t.triggerAttach(),u?(r(t.child,h),t.child.classList.add(h?"entrance-in-fade":"entrance-in"),setTimeout(function(){r(t.child,h),t.activeView&&r(t.activeView,h),p.css(o),l()},f)):p.animate(a,{duration:f,easing:"swing",always:function(){p.css(o),l()}})}if(t.child){var f=t.duration||500,p=n(t.child),h=!!t.fadeOnly,m={display:"block",opacity:0,position:"absolute",left:h||u?"0px":"20px",right:0,top:0,bottom:0};p.css(m),t.activeView?u&&!s?(r(t.activeView,h),t.activeView.classList.add("entrance-out"),setTimeout(d,i)):n(t.activeView).fadeOut({duration:i,always:d}):d()}else n(t.activeView).fadeOut(i,l)}).promise()};return f});